/*! Things v0.0.0 | (c) Hatio, Lab. | MIT License */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("lodash")):"function"==typeof define&&define.amd?define(["lodash"],e):"object"==typeof exports?exports.things=e(require("lodash")):t.things=e(t.lodash)}(this,function(t){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){var i,r;i=[n(1)],r=function(t){"use strict";var e;return e=[],{create:function(n){var i;return i=new t(n).getStage(),e.push(i),i},destroy:function(t){var n;return n=e.indexOf(t),n>-1&&e.splice(n,1),t.dispose()},stages:function(){return e}}}.apply(null,i),!(void 0!==r&&(t.exports=r))},function(t,e,n){var i,r;i=[n(2),n(3),n(4),n(5),n(6),n(7),n(8),n(9),n(10),n(11),n(12),n(13)],r=function(t,e,n,i,r,o,s,u,c,a,h,l){"use strict";var p;return n.include({setController:function(t){return this.controller=t},getController:function(){return this.controller},getStage:function(){return this.controller.getStage()},setSpec:function(t){return this.spec=t},getSpec:function(){return this.spec},build:function(t,e){return this.controller.build(t,e||this)},require:function(t){if(!this.controller)throw new Error("controller not initialized");return this.controller.require(t)},select:function(t,e){if(!this.controller)throw new Error("controller not initialized");return this.controller.select(t,e)},abs:function(t){var e,n;return n=this.get(t)||0,e=this.getContainer(),e&&(n+=e.abs(t)||0),n},debug:function(t,e){return this.require("debug-layer").debug(t,e)}}),p=function(){function n(n){this.options=t.clone(n),this.exports={},this.exportsManager=new a(this),this.commandManager=new h,this.componentRegistry=new i,this.componentRegistry.setRegisterCallback(function(t){return this.exportsManager["import"](t.type,t.exports)},this),this.componentRegistry.setUnregisterCallback(function(t){return this.exportsManager.remove(t.type)},this),this.eventEngine=new s,this.componentFactory=new o(this.componentRegistry,this),this.stage=this.componentFactory.createModel(n),this.eventEngine.setRoot(this.stage),this.stage.event_map&&this.eventEngine.add(this.stage,this.stage.event_map(),this.stage),this.eventEngine.add(this,l,this),this.componentFactory.setupDescendant(this.stage),e.mobile||(this.mouseEvent=new u(this.stage)),this.touchEvent=new c(this.stage)}return n.prototype.setStage=function(t){return this.stage=t},n.prototype.getStage=function(){return this.stage},n.prototype.build=function(t,e){return this.componentFactory.build(t,e)},n.prototype.select=function(t,e){return r.select(t,e||this.stage)},n.prototype["import"]=function(t,e,n){return this.exportsManager["import"](t,e,n)},n.prototype.require=function(t){return this.exportsManager.require(t)},n.prototype.dispose=function(){return this.componentFactory.dispose(),this.comandManager.dispose(),this.eventEngine.dispose(),this.componentRegistry.dispose(),this.mouseEvent&&this.mouseEvent.dispose(),this.touchEvent.dispose(),this.exportsManager.dispose()},n}()}.apply(null,i),!(void 0!==r&&(t.exports=r))},function(e){e.exports=t},function(t){var e,n;e=[],n=function(){var t;return t={version:"@@version",listenClickTap:!1,inDblClickWindow:!1,enableTrace:!1,traceArrMax:100,dblClickWindow:400,pixelRatio:void 0,dragDistance:0,angleDeg:!0,showWarnings:!0,Filters:{},isDragging:function(){var t;return t=things.DD,t?t.isDragging:!1},isDragReady:function(){var t;return t=things.DD,t?!!t.node:!1},_parseUA:function(t){var e,n,i,r;return r=t.toLowerCase(),n=/(chrome)[ \/]([\w.]+)/.exec(r)||/(webkit)[ \/]([\w.]+)/.exec(r)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(r)||/(msie) ([\w.]+)/.exec(r)||r.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(r)||[],i=!!t.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i),e=!!t.match(/IEMobile/i),{browser:n[1]||"",version:n[2]||"0",mobile:i,ieMobile:e}},UA:void 0},t.UA=t._parseUA(navigator&&navigator.userAgent||""),console.log("UA",t.UA),t}.apply(null,e),!(void 0!==n&&(t.exports=n))},function(t,e,n){var i,r,o={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var i in e)o.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=[n(14),n(18),n(19),n(20),n(21)],r=function(t,e,n,i){"use strict";var r;return r=function(t){function r(t,e){this.type=t,this.container=e}return s(r,t),r.include(e),r.include(n),r.include(i),r.prototype.getType=function(){return this.type},r.prototype.dispose=function(){return this.setContainer(null)},r.prototype.getContainer=function(){return this.container},r.prototype.setContainer=function(t){return t!==this.container?(this.container&&this.container.remove(this),this.container=t,this.container?this.container.add(this):void 0):void 0},r.prototype.moveAt=function(t){return this.getContainer()?this.container.moveChildAt(t,this):void 0},r.prototype.moveForward=function(){return this.getContainer()?this.container.moveChildForward(this):void 0},r.prototype.moveBackward=function(){return this.getContainer()?this.container.moveChildBackward(this):void 0},r.prototype.moveToFront=function(){return this.getContainer()?this.container.moveChildToFront(this):void 0},r.prototype.moveToBack=function(){return this.getContainer()?this.container.moveChildToBack(this):void 0},r}(t)}.apply(null,i),!(void 0!==r&&(t.exports=r))},function(t,e,n){var i,r,o={}.hasOwnProperty;i=[n(2)],r=function(t){"use strict";var e;return e=function(){function e(){this.componentSpecs={}}return e.prototype.dispose=function(){var t,e,n,i,r;for(t=Object.keys(this.componentSpecs),r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push(this.unregister(e));return r},e.prototype.setRegisterCallback=function(t,e){return this.callback_register="function"==typeof t?t.bind(e):void 0},e.prototype.setUnregisterCallback=function(t,e){return this.callback_unregister="function"==typeof t?t.bind(e):void 0},e.prototype.register=function(e){var n,i,r,o,s,u,c,a;if(!this.componentSpecs[e.spec.type]){if(e.spec.dependencies){c=e.spec.dependencies;for(r in c)n=c[r],this.register(n)}if(e.spec.properties instanceof Array){for(o={},a=e.spec.properties,s=0,u=a.length;u>s;s++)i=a[s],t.merge(o,i);e.spec.properties=o}return this.componentSpecs[e.spec.type]=e,this.callback_register?this.callback_register(e.spec):void 0}},e.prototype.unregister=function(t){var e;return(e=this.componentSpecs[t])?(delete this.componentSpecs[t],this.callback_unregister&&this.callback_unregister(e),e):void 0},e.prototype.forEach=function(t,e){var n,i,r,s;r=this.componentSpecs,s=[];for(n in r)o.call(r,n)&&(i=r[n],s.push(t.call(e,n,i)));return s},e.prototype.list=function(){return Object.keys(this.componentSpecs).map(function(t){return this.componentSpecs[t]},this)},e.prototype.get=function(e){var n;return n=this.componentSpecs[e],n?t.clone(this.componentSpecs[e]):null},e}()}.apply(null,i),!(void 0!==r&&(t.exports=r))},function(t,e,n){var i,r;i=[n(4),n(15)],r=function(t,e){"use strict";var n,i,r,o,s,u,c;return i=function(t,e){return t.substr(1)===e.get("id")},r=function(t,e){return t.substr(1)===e.get("name")},o=function(t,e,n,i){switch(t){case"(all)":return!0;case"(self)":return n===e;case"(root)":return i===e;default:return!1}},s=function(t,e){return"all"===t||t===e.type},n=function(t,e,n,u){if("(all)"===t)return!0;switch(t.charAt(0)){case"#":return i(t,e,n,u);case".":return r(t,e,n,u);case"(":return o(t,e,n,u);default:return s(t,e,n,u)}},c=function(t,n,i,r,o,s){return t(n,i,r,o)&&s.push(i),i instanceof e&&i.forEach(function(e){return c(t,n,e,r,o,s)}),s},u=function(t,e,n){var u;return"(root)"===t?[e]:"(self)"===t?[n]:(u=function(){switch(t.charAt(0)){case"#":return i;case".":return r;case"(":return o;default:return s}}(),c(u,t,e,n,e,[]))},{select:u,match:n}}.apply(null,i),!(void 0!==r&&(t.exports=r))},function(t,e,n){var i,r;i=[n(2)],r=function(t){"use strict";var e;return e=function(){function e(t,e){this.componentRegistry=t,this.controller=e}return e.prototype.dispose=function(){return this.componentRegistry=null,this.controller=null},e.prototype.build=function(t,e){var n;return n=this.createModel(t),e&&e.add(n),this.setupDescendant(n,t.components),n.setup&&n.setup(t),n},e.prototype.createModel=function(e){var n,i,r,o,s;if(e.dependencies){s=e.dependencies;for(r in s)i=s[r],this.componentRegistry.register(i)}if(o=this.componentRegistry.get(e.type),!o)throw new Error("module ("+e.type+") is not registered yet.");return e.attrs||(e.attrs={}),e.attrs.hasOwnProperty("id")||(e.attrs.id=t.uniqueId()),n=new o(e.type).initialize(e.attrs,o.spec.properties),n.setController(this.controller),n.init&&n.init(e),n},e.prototype.setupDescendant=function(t,e){var n,i,r,o,s,u,c,a;if(i=this.componentRegistry.get(t.type),r=i.spec,r.components)for(a=r.components,o=0,u=a.length;u>o;o++)n=a[o],this.build(n,t);if(e)for(s=0,c=e.length;c>s;s++)n=e[s],this.build(n,t);return t},e}()}.apply(null,i),!(void 0!==r&&(t.exports=r))},function(t,e,n){var i,r,o={}.hasOwnProperty;i=[n(2),n(16),n(6)],r=function(t,e,n){"use strict";var i;return i=function(){function i(t){this.eventMaps=[],this.setRoot(t)}return i.prototype.setRoot=function(t){return this.root=t},i.prototype.stop=function(){var t,e,n,i,r;for(i=this.eventMaps,r=[],e=0,n=i.length;n>e;e++)t=i[e],r.push(t.eventPump.stop());return r},i.prototype.add=function(t,i,r){var s,u,c,a,h,l,p,f,d,_,v;if(this.root){if(!(i instanceof Array))return void this.add(t,[i],r);for(v=[],d=0,_=i.length;_>d;d++)u=i[d],v.push(function(){var i;i=[];for(a in u)if(o.call(u,a)){if(c=u[a],0===a.indexOf("?")){if(f=a.substr(1),p=t.get(f),!p){console.log("EventEngine#add","variable "+a+" is not evaluated on listener");continue}a=p}l=n.select(a,this.root,t),i.push(function(){var n,i,o;for(o=[],n=0,i=l.length;i>n;n++)h=l[n],s=new e(h),s.on(t,c),s.start(r),o.push(this.eventMaps.push({eventPump:s,listener:t,handlerMap:u,target:h}));return o}.call(this))}return i}.call(this));return v}},i.prototype.remove=function(e,n){var i,r,o,s,u,c;for(o=t.clone(this.eventMaps),c=[],i=s=0,u=o.length;u>s;i=++s)r=o[i],r.listener!==e||n&&r.handlerMap!==n?c.push(void 0):(this.eventMaps.splice(i,1),c.push(r.eventPump.dispose()));return c},i.prototype.clear=function(){var e,n,i,r;for(n=t.clone(this.eventMaps),i=0,r=n.length;r>i;i++)e=n[i],e.eventPump.dispose();return this.eventMaps=[]},i.prototype.dispose=function(){return this.stop(),this.clear()},i}()}.apply(null,i),!(void 0!==r&&(t.exports=r))},function(t,e,n){var i,r;i=[n(17),n(22)],r=function(t,e){"use strict";var n,i,r,o,s,u,c;return r=function(n){var i;return i=this.stage.point(n),this.captured=this.stage.capture(i),this.click_target=this.captured,t.draggable=!0,e.mousedown(this.captured,n,i),n.preventDefault?n.preventDefault():void 0},c=function(n){var i,r,o;return r=this.stage.point(n),this.captured=this.stage.capture(r),i=!1,this.listening_dbl_click?(i=!0,this.listening_dbl_click=!1):this.listening_dbl_click=!0,o=this,setTimeout(function(){return o.listening_dbl_click=!1},500),this.captured&&!t.dragging&&(e.mouseup(this.captured,n,r),this.click_target&&this.captured===this.click_target&&(e.click(this.captured,n,r),i&&(e.doubleclick(this.captured,n,r),this.listening_dbl_click=!1))),this.click_target=null,n.preventDefault?n.preventDefault():void 0},u=function(n){var i,r,o,s,u;if("undefined"==typeof n.webkitMovementX&&"undefined"==typeof n.webkitMovementY||0!==n.webkitMovementY||0!==n.webkitMovementX){if(u=this.stage.point(n),r=this.captured,this.captured=this.stage.capture(u),!t.dragging&&(this.captured&&e.mousemove(this.captured,n,u),this.captured!==r)){if(o=[this.captured],this.captured)for(;i=(i||this.captured).getContainer();)o.unshift(i);if(s=[r],r)for(;i=(i||r).getContainer();)s.unshift(i);for(;s[0]===o[0];)s.shift(),o.shift();for(;i=s.pop();)e.mouseout(i,n,u);for(;i=o.shift();)e.mouseover(i,n,u)}return t.draggable&&this.captured&&t.drag(this.captured,n,u),n.preventDefault?n.preventDefault():void 0}},s=function(t){var n,i,r;if(!this.dragging){if(this.captured){for(r=this.stage.point(t),n=this.captured,i=[this.captured];n=n.getContainer();)i.unshift(n);for(;n=i.pop();)e.mouseout(n,t,r)}return this.captured=null}},o=function(){},i=function(t){var n;return t.preventDefault(),n=this.stage.point(t),this.captured=this.stage.capture(n),e.contextmenu(this.captured,t,n)},n=function(){function t(t){this.stage=t,this.onmousemove=u.bind(this),this.onmouseleave=s.bind(this),this.onmouseenter=o.bind(this),this.onmouseup=c.bind(this),this.onmousedown=r.bind(this),this.oncontextmenu=i.bind(this),this.stage.html_container.addEventListener("mousemove",this.onmousemove),this.stage.html_container.addEventListener("mouseleave",this.onmouseleave),this.stage.html_container.addEventListener("mouseenter",this.onmouseenter),this.stage.html_container.addEventListener("mouseup",this.onmouseup),this.stage.html_container.addEventListener("mousedown",this.onmousedown),this.stage.html_container.addEventListener("contextmenu",this.oncontextmenu)}return t.prototype.dispose=function(){return this.stage.html_container.removeEventListener("mousemove",this.onmousemove),this.stage.html_container.removeEventListener("mouseleave",this.onmouseleave),this.stage.html_container.removeEventListener("mouseenter",this.onmouseenter),this.stage.html_container.removeEventListener("mouseup",this.onmouseup),this.stage.html_container.removeEventListener("mousedown",this.onmousedown),this.stage.html_container.removeEventListener("contextmenu",this.oncontextmenu)},t}()}.apply(null,i),!(void 0!==r&&(t.exports=r))},function(t,e,n){var i,r;i=[n(22),n(17)],r=function(t,e){"use strict";var n,i,r,o;return o=function(e){var n,i,r;return n=this.stage.point(e),r=this.stage.capture(n),this.tap_target=r,i=this,this.longtouch_triggered=!1,this.longtouch_timer=setTimeout(function(){return i.longtouch_timer=null,r&&t.longtouch(r,e,n),i.longtouch_triggered=!0},500),t.touchstart(r,e,n),e.preventDefault?e.preventDefault():void 0},i=function(n){var i,r,o,s;return r=this.stage.point(n),s=this.stage.capture(r),this.longtouch_timer&&(clearTimeout(this.longtouch_timer),this.longtouch_timer=null),i=!1,this.listening_dbl_click?(i=!0,this.listening_dbl_click=!1):this.listening_dbl_click=!0,o=this,setTimeout(function(){return o.listening_dbl_click=!1},500),s&&!e.dragging&&(t.touchend(s,n,r),this.tap_target&&s===this.tap_target&&(t.tap(s,n,r),i&&(t.doubletap(s,n,r),this.listening_dbl_click=!1))),this.tap_target=null,n.preventDefault?n.preventDefault():void 0},r=function(n){var i,r;if(i=this.stage.point(n),this.longtouch_timer&&e.dragging)clearTimeout(this.longtouch_timer),this.longtouch_timer=null;else if(this.longtouch_triggered)return void(n.preventDefault&&n.preventDefault());return r=this.stage.capture(i),!e.dragging&&r&&(t.touchmove(r,n,i),n.preventDefault&&n.preventDefault()),e.drag(r,n,i),n.preventDefault?n.preventDefault():void 0},n=function(){function t(t){this.stage=t,this.ontouchstart=o.bind(this),this.ontouchmove=r.bind(this),this.ontouchend=i.bind(this),this.stage.html_container.addEventListener("touchstart",this.ontouchstart),this.stage.html_container.addEventListener("touchmove",this.ontouchmove),this.stage.html_container.addEventListener("touchend",this.ontouchend)}return t.prototype.dispose=function(){return this.stage.html_container.removeEventListener("touchstart",this.ontouchstart),this.stage.html_container.removeEventListener("touchmove",this.ontouchmove),this.stage.html_container.removeEventListener("touchend",this.ontouchend)},t}()}.apply(null,i),!(void 0!==r&&(t.exports=r))},function(t){var e,n;e=[],n=function(){"use strict";var t;return t=function(){function t(t){this.binder=t,this.exports={}}return t.prototype.dispose=function(){var t,e,n,i,r;for(e=Object.keys(this.exports),r=[],n=0,i=e.length;i>n;n++)t=e[n],r.push(this.remove(t));return r},t.prototype["import"]=function(t,e,n){var i,r,o;if(e){o={};for(i in e)r=e[i],o[i]=r instanceof Function?r.bind(n||this.binder):r;return this.exports[t]=o}},t.prototype.remove=function(t){return delete this.exports[t]},t.prototype.require=function(t){return this.exports[t]},t}()}.apply(null,e),!(void 0!==n&&(t.exports=n))},function(t,e,n){var i,r;i=[n(23)],r=function(t){"use strict";var e;return e=function(){function e(){this.reset()}return e.prototype.dispose=function(){return this.reset()},e.prototype.execute=function(e){return!e instanceof t?void 0:(e.execute(),this.exq.push(e),this.uxq=[])},e.prototype.undo=function(){var t;return t=this.exq.pop(),t?(t.unexecute(),this.uxq.push(t)):void 0},e.prototype.redo=function(){var t;return t=this.uxq.pop(),t?(t.execute(),this.exq.push(t)):void 0},e.prototype.undoable=function(){return this.exq.length>0},e.prototype.redoable=function(){return this.uxq.length>0},e.prototype.reset=function(){return this.exq=[],this.uxq=[]},e}()}.apply(null,i),!(void 0!==r&&(t.exports=r))},function(t){var e,n;e=[],n=function(){"use strict";var t,e;return t=function(t,e){var n;if(e.event_map)return n=e.event_map(),this.eventEngine.add(e,n,e)},e=function(t,e){return this.eventEngine.remove(e)},{"(root)":{"(all)":{add:t,remove:e}}}}.apply(null,e),!(void 0!==n&&(t.exports=n))},function(t){var e,n,i=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};e=[],n=function(){"use strict";var t,e;return e=["extended","included"],t=function(){function t(){}return t.extend=function(t){var n,r,o;for(n in t)r=t[n],i.call(e,n)<0&&(console.log(n,r),this[n]=r);return null!=(o=t.extended)&&o.apply(this),this},t.include=function(t){var n,r,o;for(n in t)r=t[n],i.call(e,n)<0&&(this.prototype[n]=r);return null!=(o=t.included)&&o.apply(this),this},t}()}.apply(null,e),!(void 0!==n&&(t.exports=n))},function(t,e,n){var i,r,o={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var i in e)o.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};i=[n(2),n(4),n(24)],r=function(t,e,n){"use strict";var i,r,o,u,c,a,h,l,p,f,d,_,v,g,m,y;return r=[],u=function(t,i){var r,o,s;if(r=i instanceof e,r&&(s=i.getContainer())){if(t===s)return;m(t,i)}return o=t.__components__.push(i)-1,r&&i.setContainer(t),n.add(t,t,i,o),r?(i.delegate_on(t),n.added(i,t,i,o)):void 0},m=function(t,i){var r,o;return r=i instanceof e,o=t.__components__.indexOf(i),-1!==o&&(o>-1&&t.__components__.splice(o,1),r&&i.setContainer(null),n.remove(t,t,i),i instanceof e)?(n.removed(i,t,i),i.delegate_off(t)):void 0},o=function(t){var e,n,i;if(this.__components__||(this.__components__=[]),!(t instanceof Array))return o.call(this,[t]);for(n=0,i=t.length;i>n;n++)e=t[n],u(this,e);return this},v=function(t){var e,n,i;if(!(t instanceof Array))return v.call(this,[t]);if(this.__components__){for(n=0,i=t.length;i>n;n++)e=t[n],m(this,e);return this}},g=function(){return this.remove(t.clone(this.__components__))},a=function(t){return this.__components__?this.__components__[t]:void 0},c=function(t,e){return this.__components__?this.__components__.forEach(t,e):void 0},h=function(t){return(this.__components__||r).indexOf(t)},y=function(){return(this.__components__||r).length},l=function(t,e){var n,i,r;return i=this.indexOf(e),-1!==i?(n=this.__components__.splice(0,i),r=this.__components__.splice(1),this.__components__=n.concat(r),t=Math.max(0,t),t=Math.min(t,this.__components__.length),n=this.__components__.splice(0,t),this.__components__=n.concat(e,this.__components__)):void 0},f=function(t){var e;return e=this.indexOf(t),-1!==e&&e!==this.size()-1?(this.__components__[e]=this.__components__[e+1],this.__components__[e+1]=t):void 0},p=function(t){var e;return e=this.indexOf(t),-1!==e&&0!==e?(this.__components__[e]=this.__components__[e-1],this.__components__[e-1]=t):void 0},_=function(t){var e,n,i;return n=this.indexOf(t),-1!==n&&n!==this.size()-1?(e=this.__components__.splice(0,n),i=this.__components__.splice(1),this.__components__=e.concat(i,this.__components__)):void 0},d=function(t){var e,n,i;return n=this.indexOf(t),-1!==n&&0!==n?(e=this.__components__.splice(0,n),i=this.__components__.splice(1),this.__components__=this.__components__.concat(e,i)):void 0},i=function(e){function n(t){n.__super__.constructor.call(this,t)}return s(n,e),n.prototype.dispose=function(){var e,i,r,o;if(this.__components__){for(e=t.clone(this.__components__),r=0,o=e.length;o>r;r++)i=e[r],i.dispose();this.__components__=null}return n.__super__.dispose.call(this)},n.prototype.add=o,n.prototype.remove=v,n.prototype.removeAll=g,n.prototype.size=y,n.prototype.getAt=a,n.prototype.indexOf=h,n.prototype.forEach=c,n.prototype.moveChildAt=l,n.prototype.moveChildForward=f,n.prototype.moveChildBackward=p,n.prototype.moveChildToFront=_,n.prototype.moveChildToBack=d,n}(e)}.apply(null,i),!(void 0!==r&&(t.exports=r))},function(t,e,n){var i,r,o={}.hasOwnProperty;i=[n(2),n(6)],r=function(t,e){"use strict";var n,i,r;return i=function(t,n,i,r,s){var u,c,a,h,l;l=[];for(h in i)o.call(i,h)&&(u=i[h],e.match(h,r.origin,n,t)&&l.push(function(){var t;t=[];for(c in u)o.call(u,c)&&(a=u[c],c===r.name&&(r.listener=n,t.push(a.apply(this,s))));return t}.call(this)));return l},r=function(){var t,e,n,r,o,s,u,c;for(t=arguments,e=t[t.length-1],n=this.eventPump,u=n.listeners,c=[],o=0,s=u.length;s>o;o++)r=u[o],c.push(i.call(this.context,n.deliverer,r.listener,r.clonedHandlers,e,t));return c},n=function(){function t(t){this.setDeliverer(t),this.listeners=[]}return t.prototype.setDeliverer=function(t){return this.deliverer=t},t.prototype.start=function(t){return this.deliverer.on("all",r,{context:t||null,eventPump:this})},t.prototype.stop=function(){return this.deliverer.off("all",r)},t.prototype.on=function(t,e){var n,i,r,o,s,u,c,a;for(n=_.clone(e),o=Object.keys(n),c=0,a=o.length;a>c;c++)r=o[c],0===r.indexOf("?")&&(i=n[r],u=r.substr(1),s=t.get(u),delete n[r],s?n[s]=i:console.log("EventPump#on","variable "+r+" is not evaluated on listener"));return this.listeners.push({listener:t,handlers:e,clonedHandlers:n})},t.prototype.off=function(t,e){var n,i,r,o,s,u;for(s=this.listeners,u=[],n=r=0,o=s.length;o>r;n=++r)i=s[n],u.push(i.listener!==t||e&&i.handlers!==e?void 0:this.listeners.splice(n,1));return u},t.prototype.clear=function(){return this.listeners=[]},t.prototype.dispose=function(){return this.stop(),this.clear()},t}()}.apply(null,i),!(void 0!==r&&(t.exports=r))},function(t,e,n){var i,r;i=[n(22)],r=function(t){var e,n,i;return i=function(){},n=function(n){var i,r;return e.dragging=!1,r=e.target,r&&(i=r.getStage().point(n),t.dragend(e.target,n,i)),delete e.target,e.cleanup()},e={draggable:!1,dragging:!1,target:null,drag_end_target:null,start_point:null,last_point:null,cutoff:4,cleanup:function(){return this.target=null,this.drag_end_target=null,this.start_point=null,this.last_point=null,this.dragging=!1,this.draggable=!1},drag:function(e,n,i){var r;if(this.start_point||(this.start_point=i),!this.dragging&&e.get("draggable")){if(void 0!==n.touches&&(r=Math.max(Math.abs(i.x-this.start_point.x),Math.abs(i.y-this.start_point.y)),r<this.cutoff))return;this.dragging=!0,this.target=e,t.dragstart(e,n,this.start_point)}return this.dragging?(this.last_point=i,t.drag(this.target,n,i)):void 0}},document.addEventListener("mouseup",i,!0),document.addEventListener("touchend",i,!0),document.addEventListener("mouseup",n,!1),document.addEventListener("touchend",n,!1),e}.apply(null,i),!(void 0!==r&&(t.exports=r))},function(t,e,n){var i,r,o={}.hasOwnProperty;i=[n(2)],r=function(t){"use strict";var e;return e={silentSet:function(e,n){var i,r,s,u;if(!e)return this;if(arguments.length>1&&"string"==typeof arguments[0])return r={},r[e]=n,this.silentSet(r);this.attrs||(this.attrs={}),r=e,i={},s=t.clone(this.attrs),t.assign(this.attrs,r),u=this.attrs;for(e in u)o.call(u,e)&&(n=u[e],n!==s[e]?i[e]=n:delete s[e]);return this},set:function(e,n){var i,r,s,u;if(!e)return this;if(arguments.length>1&&"string"==typeof arguments[0])return r={},r[e]=n,this.set(r);this.attrs||(this.attrs={}),r=e,i={},s=t.clone(this.attrs),t.assign(this.attrs,r),u=this.attrs;for(e in u)o.call(u,e)&&(n=u[e],n!==s[e]?i[e]=n:delete s[e]);return 0!==Object.keys(i).length&&this.trigger("change",this,s,i),this},get:function(t){var e;if(this.attrs&&this.attrs.hasOwnProperty(t))return this.attrs[t];if(this.property_spec)return e=this.property_spec[t],e?e["default"]:void 0},getAll:function(){return this.attrs?t.clone(this.attrs):{}}}}.apply(null,i),!(void 0!==r&&(t.exports=r))},function(t){var e,n;e=[],n=function(){"use strict";var t;return t={initialize:function(t,e){return this.attrs=t,this.property_spec=e,this},dispose:function(){}}}.apply(null,e),!(void 0!==n&&(t.exports=n))},function(t,e,n){var i,r;i=[n(2),n(25)],r=function(t,e){"use strict";var n,i,r,o,s,u,c,a;n={on:function(t,e,n){var i;return o(this,"on",t,[e,n])&&e?(this._listeners||(this._listeners={}),i=this._listeners[t]||(this._listeners[t]=[]),i.push({callback:e,context:n,ctx:n||this}),this):this},once:function(e,n,i){var r,s;return o(this,"once",e,[n,i])&&n?(s=this,r=t.once(function(){return s.off(e,r),n.apply(this,arguments)}),r._callback=n,this.on(e,r,i)):this},off:function(t,e,n){var i,r,s,u,c,a,h,l,p,f;if(!this._listeners||!o(this,"off",t,[e,n]))return this;if(!t&&!e&&!n)return this._listeners=void 0,this;for(c=t?[t]:Object.keys(this._listeners),s=h=0,p=c.length;p>h;s=++h)if(t=c[s],r=this._listeners[t]){if(this._listeners[t]=a=[],e||n)for(u=l=0,f=r.length;f>l;u=++l)i=r[u],(e&&e!==i.callback&&e!==i.callback._callback||n&&n!==i.context)&&a.push(i);a.length||delete this._listeners[t]}return this},delegate_on:function(t){return this._delegators||(this._delegators=new e.List),this._delegators.append(t),this},delegate_off:function(t){return this._delegators?(this._delegators.remove(t),this):this},delegate:function(){var t,e,n;return this._delegators&&this._delegators.size()>0&&i(this._delegators,arguments),this._listeners?(t=arguments[arguments.length-1],t.deliverer=this,e=this._listeners[t.name],n=this._listeners.all,e&&a(e,arguments),n&&a(n,arguments),this):this},trigger:function(t){var e,n,r;return e=[].slice.call(arguments,1),e.push({origin:this,name:t,deliverer:this}),this._delegators&&this._delegators.size()>0&&i(this._delegators,e),this._listeners&&o(this,"trigger",t,e)?(n=this._listeners[t],r=this._listeners.all,n&&a(n,e),r&&a(r,e),this):this},stopListening:function(e,n,i){var r,o,s;if(o=this._listeningTo,!o)return this;s=!n&&!i,i||"object"!=typeof n||(i=this),e&&((o={})[e._listenId]=e);for(r in o)e=o[r],e.off(n,i,this),(s||t.isEmpty(e._events))&&delete this._listeningTo[r];return this}},r=/\s+/,o=function(t,e,n,i){var o,s,u,c,a;if(!n)return!0;if("object"==typeof n){for(o in n)u=n[o],t[e].apply(t,[o,u].concat(i));return!1}if(r.test(n)){for(s=n.split(r),c=0,a=s.length;a>c;c++)u=s[c],t[e].apply(t,[u].concat(i));return!1}return!0},a=function(t,e){var n,i,r,o;for(o=[],i=0,r=t.length;r>i;i++)n=t[i],o.push(n.callback.apply(n.ctx,e));return o},i=function(t,e){return t.forEach(function(t){return n.delegate.apply(t,e)})},u={listenTo:"on",listenToOnce:"once"};for(c in u)s=u[c],n[c]=function(e,n,i){var r,o;return o=this._listeningTo||(this._listeningTo={}),r=e._listenId||(e._listenId=t.uniqueId("l")),o[r]=e,i||"object"!=typeof n||(i=this),e[s](n,i,this),this};return n}.apply(null,i),!(void 0!==r&&(t.exports=r))},function(t){var e,n;e=[],n=function(){"use strict";var t;return t={serialize:function(){return["type: "+this.name,"id: "+this.id,"props: "+JSON.stringify(this.attrs)].join(",")},deserialize:function(){}}}.apply(null,e),!(void 0!==n&&(t.exports=n))},function(t,e,n){var i,r;i=[n(2)],r=function(t){"use strict";var e,n,i;return i=function(t,e,n,i){var r,o;return i||(o=t.getStage(),i=o.point(n)),r={origin:n,type:e,target:t,offsetX:i.x,offsetY:i.y},t.trigger(r.type,r)},e=function(t){return function(e,n,r){return i(e,t,n,r)}},n=["mousemove","mousedown","mouseup","click","doubleclick","contextmenu","mouseover","mouseout","dragstart","drag","dragend","touchstart","touchmove","touchend","longtouch","tap","doubletap"],t.reduce(n,function(t,n){return t[n]=e(n),t},{})}.apply(null,i),!(void 0!==r&&(t.exports=r))},function(t,e,n){var i,r;i=[n(2)],r=function(t){"use strict";var e;return e=function(){function e(e){this.params=t.clone(e)}return e.prototype.execute=function(){},e.prototype.unexecute=function(){},e}()}.apply(null,i),!(void 0!==r&&(t.exports=r))},function(t){var e,n;e=[],n=function(){"use strict";var t,e,n,i;return t=function(t,e,n,i){return t.trigger("add",e,n,i)},e=function(t,e,n,i){return t.trigger("added",e,n,i)},n=function(t,e,n){return t.trigger("remove",e,n)},i=function(t,e,n){return t.trigger("removed",e,n)},{add:t,added:e,remove:n,removed:i}}.apply(null,e),!(void 0!==n&&(t.exports=n))},function(t){var e,n,i={}.hasOwnProperty;e=[],n=function(){"use strict";var t,e,n,r,o;return r={insertAt:function(t,e){return this.__collection__?(t=this.__collection__.indexOf(e),-1===this.__collection__.indexOf(e)&&this.__collection__.splice(t,0,e),this):this},append:function(t){return this.__collection__||(this.__collection__=[]),-1===this.__collection__.indexOf(t)&&this.__collection__.push(t),this},prepend:function(t){return this.__collection__||(this.__collection__=[]),-1===this.__collection__.indexOf(t)&&this.__collection__.unshift(t),this},remove:function(t){var e;return this.__collection__?(e=this.__collection__.indexOf(t),e>-1&&this.__collection__.splice(e,1),this):this},getAt:function(t){return this.__collection__?this.__collection__[t]:void 0},forEach:function(t,e){return this.__collection__?this.__collection__.forEach(t,e):this},indexOf:function(t){return(this.__collection__||[]).indexOf(t)},size:function(){return(this.__collection__||[]).length},clear:function(){return this.__collection__=[]},moveForward:function(t){var e;return e=this.indexOf(t),-1!==e&&0!==e?(this.__collection__[e]=this.__collection__[e-1],this.__collection__[e-1]=t):void 0},moveBackward:function(t){var e;return e=this.indexOf(t),-1!==e&&e!==this.size()-1?(this.__collection__[e]=this.__collection__[e+1],this.__collection__[e+1]=t):void 0},moveToHead:function(t){var e,n,i;return n=this.indexOf(t),-1!==n&&0!==n?(e=this.__collection__.splice(0,n),i=this.__collection__.splice(1),this.__collection__=this.__collection__.concat(e,i)):void 0},moveToTail:function(t){var e,n,i;return n=this.indexOf(t),-1!==n&&n!==this.size()-1?(e=this.__collection__.splice(0,n),i=this.__collection__.splice(1),this.__collection__=e.concat(i,this.__collection__)):void 0}},o={push:function(){throw new Error("Not Implemented Yet")},pop:function(){throw new Error("Not Implemented Yet")}},e=function(){},e.prototype=r,n=function(){},n.prototype=o,t={List:e,Stack:n,withList:function(){var t,e,n;n=[];for(t in r)i.call(r,t)&&(e=r[t],n.push(this[t]=e));return n},withStack:function(){var t,e,n;n=[];for(t in o)i.call(o,t)&&(e=o[t],n.push(this[t]=e));return n}}}.apply(null,e),!(void 0!==n&&(t.exports=n))}])});